/**
 * The process of cluster module
 */
var cluster = require('cluster');
var http = require('http');

/**
 * master process
 */
exports.master = function(){

    //进程交互事件
    var message = function(msg){

    };

    //创建子进程
    var createWorker = function(){
        var worker = cluster.fork();
        worker.on('exit', function(code, signal) {
            //重启worker（此时进程id会增加1，以示和原错误关闭进程区别）
            !worker.suicide && (console.log('Separation of new sub process process...'),setTimeout(createWorker,2000));
        });
    };

    for(var i=0;i<harbors.config.server.process;i++){
        createWorker();
    }

};

/**
 * worker process
 * @param {Function} callback
 */
exports.worker = function(callback){
    http.createServer(function(req,res){

        callback(req,res);
    }).listen(harbors.config.server.listen);
};