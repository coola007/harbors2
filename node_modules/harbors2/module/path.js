/**
 * Path analysis module
 */
var path = require('path');
var fs = require('fs');

exports.analysis = function(req){
    var vhostName,moduleName,Extname,Dir,File;
    //虚拟主机开关
    harbors._vhost=='true' ?
        vhostName = 'vhost:'+req.headers.host.split(':')[0] :
        vhostName = 'server';
    //补全路径
    /\/$/.test(req.url) ?
        //请求以/结尾
        (function(){
            File = harbors.config[vhostName].default_file;
            moduleName = 'index' + harbors._module;
            Dir = path.join(harbors.config[vhostName].dir,req.url);
        })() :
        //请求不以/结尾
        (function(){
            File = path.basename(req.url);
            moduleName = File + harbors._module;
            Dir = path.join(harbors.config[vhostName].dir,path.dirname(req.url));
        })();

    /_\.js/.test(File) ?
        (Extname = '', moduleName = File) :
        (Extname = path.extname(File));
    return {
        vhostName:vhostName,
        Dir:Dir,
        File:File,
        Extname:Extname,
        Module:moduleName
    };
};

exports.exists = function (file,yes,no){

    fs.exists(file,function(exists){
        exists ? yes() : no();
    });

};
